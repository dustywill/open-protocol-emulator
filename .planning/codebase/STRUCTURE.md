# Codebase Structure

**Analysis Date:** 2026-01-16

## Directory Layout

```
open-protocol-emulator/
├── .planning/              # Planning artifacts (GSD workflow)
│   └── codebase/          # Codebase analysis documents
├── open_protocol_emulator.py  # Main application (811 lines)
├── node-red-testflow_open_protocol.json  # Node-RED test flow
├── docker-compose.yml     # Docker service configuration
├── Dockerfile             # Node-RED container definition
├── README.md              # Project documentation
├── LICENSE                # GPL-3.0 license
└── .gitignore            # Git exclusions
```

## Directory Purposes

**.planning/codebase/:**
- Purpose: Codebase analysis and mapping documents
- Contains: STACK.md, ARCHITECTURE.md, STRUCTURE.md, etc.
- Generated by: GSD map-codebase workflow
- Subdirectories: None

**Root Directory:**
- Purpose: All project files (flat structure)
- Contains: Python source, Docker config, documentation
- Key files: `open_protocol_emulator.py` (main application)
- Subdirectories: `.planning/`

## Key File Locations

**Entry Points:**
- `open_protocol_emulator.py:787-810` - Main entry with argparse

**Configuration:**
- `docker-compose.yml` - Docker service ports and volumes
- `Dockerfile` - Container build instructions
- `.gitignore` - Git exclusions (pset_parameters_*.json)

**Core Logic:**
- `open_protocol_emulator.py:13-33` - Message building helper
- `open_protocol_emulator.py:35-563` - OpenProtocolEmulator class
- `open_protocol_emulator.py:274-448` - MID dispatch logic
- `open_protocol_emulator.py:451-563` - Tightening result generation
- `open_protocol_emulator.py:564-784` - Tkinter GUI

**Testing:**
- `node-red-testflow_open_protocol.json` - Node-RED integration test flow
- No automated tests present

**Documentation:**
- `README.md` - User-facing documentation
- `LICENSE` - GPL-3.0 license text

**Generated Files (gitignored):**
- `pset_parameters_{controller_name}.json` - Runtime Pset configurations

## Naming Conventions

**Files:**
- snake_case.py: Python modules (`open_protocol_emulator.py`)
- kebab-case.json: JSON data files (`node-red-testflow_open_protocol.json`)
- UPPERCASE.md: Important project files (`README.md`, `LICENSE`)

**Directories:**
- lowercase: All directories (`.planning/`, `codebase/`)
- No special naming patterns

**Special Patterns:**
- `pset_parameters_{name}.json`: Dynamic runtime files per controller

## Where to Add New Code

**New Feature:**
- Primary code: Extend `OpenProtocolEmulator` class in `open_protocol_emulator.py`
- Tests: Create `tests/` directory (not yet established)
- Config if needed: Add to constructor arguments

**New MID Handler:**
- Definition: Add elif branch in `process_message()` at ~line 274
- Handler: Add method to `OpenProtocolEmulator` class
- Tests: Not currently established

**New GUI Element:**
- Implementation: Add to `start_gui()` method starting at line 564
- Frame placement: Follow existing pattern with LabelFrame
- Callbacks: Define as nested functions within `start_gui()`

**New Configuration:**
- Add to `argparse` setup at lines 789-793
- Add to `__init__` constructor at lines 37-77

**Utilities:**
- Currently all in single file
- If extracted: Create `utils/` or `lib/` directory

## Special Directories

**.planning/:**
- Purpose: GSD workflow planning artifacts
- Source: Generated by GSD commands
- Committed: Yes (for documentation)

**.planning/codebase/:**
- Purpose: Codebase analysis documents
- Source: Generated by `/gsd:map-codebase`
- Committed: Yes

**Generated Runtime Files:**
- Pattern: `pset_parameters_*.json`
- Purpose: Persist Pset configuration per controller
- Committed: No (in .gitignore)

---

*Structure analysis: 2026-01-16*
*Update when directory structure changes*
