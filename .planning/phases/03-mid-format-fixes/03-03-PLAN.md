---
phase: 03-mid-format-fixes
plan: 03
type: execute
depends_on: []
files_modified: [open_protocol_emulator.py]
autonomous: true
---

<objective>
Fix tightening result MID deviations from Phase 2 audit (MID 0060-0063).

Purpose: Correct MID 0061 field lengths and fix VIN truncation.
Output: MID 0061 Tightening ID is 10 digits (not 4), VIN field properly truncated to 25 chars.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-mid-format-audit/02-03-AUDIT.md

@open_protocol_emulator.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix MID 0061 Field 23 Tightening ID length</name>
  <files>open_protocol_emulator.py</files>
  <action>
Fix Tightening ID field (Field 23) in MID 0061 to be 10 digits per spec, not 4.

Current implementation (around line 556):
```python
"23": tightening_id_str  # Where tightening_id_str = f"{tightening_id:04d}"
```

The tightening_id_str is generated earlier in the _generate_tightening_result method with 4-digit formatting.

Find the generation of tightening_id_str and change from:
```python
tightening_id_str = f"{...}:04d}"
```

To:
```python
tightening_id_str = f"{...}:010d}"
```

This changes the field from 4 digits (0001-9999) to 10 digits (0000000001-9999999999) per Open Protocol spec.

The tightening_id counter will still work the same, just with more leading zeros.

Impact: MID 0061 message length increases by 6 bytes (from 216 to 222 bytes total).
  </action>
  <verify>
Search for tightening_id formatting in the file and verify it uses 10-digit format `:010d`
  </verify>
  <done>Tightening ID field is exactly 10 digits, zero-padded</done>
</task>

<task type="auto">
  <name>Task 2: Fix MID 0061 Field 04 VIN truncation</name>
  <files>open_protocol_emulator.py</files>
  <action>
Add truncation to VIN field (Field 04) in MID 0061 to ensure exactly 25 characters.

Current implementation (around line 549):
```python
"04": self.current_vin.ljust(25),
```

This pads short VINs but doesn't truncate long VINs.

Fix to:
```python
"04": self.current_vin.ljust(25)[:25],
```

The `[:25]` slice ensures VINs longer than 25 characters are truncated to exactly 25.

Note: This matches the fix already applied in MID 0052 VIN handling where `.ljust(25)[:25]` is used.
  </action>
  <verify>
Search for Field 04 VIN assignment in MID 0061 params dict and verify `[:25]` truncation is present
  </verify>
  <done>VIN field in MID 0061 is exactly 25 characters (padded AND truncated)</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Tightening ID format is `:010d` (10 digits)
- [ ] VIN field has both `.ljust(25)` AND `[:25]`
- [ ] No syntax errors (python -m py_compile open_protocol_emulator.py)
- [ ] MID 0061 message length is now correct (222 bytes per spec calculation)
</verification>

<success_criteria>

- All tasks completed
- MID 0061 Field 23 (Tightening ID) is 10 digits
- MID 0061 Field 04 (VIN) is exactly 25 characters
- Code compiles without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/03-mid-format-fixes/03-03-SUMMARY.md`
</output>
